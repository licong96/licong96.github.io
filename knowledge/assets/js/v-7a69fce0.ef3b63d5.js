"use strict";(self.webpackChunkknowledge=self.webpackChunkknowledge||[]).push([[3742],{2542:(n,a,s)=>{s.r(a),s.d(a,{data:()=>e});const e={key:"v-7a69fce0",path:"/web-developer/back-end/wechat/wx-share.html",title:"微信分享",lang:"zh-CN",frontmatter:{},excerpt:"",headers:[{level:2,title:"获取签名",slug:"获取签名",children:[]},{level:2,title:"微信分享失败问题",slug:"微信分享失败问题",children:[{level:3,title:"问题一：第一次调用签名会失败",slug:"问题一-第一次调用签名会失败",children:[]},{level:3,title:"问题二：页面切换分享失败",slug:"问题二-页面切换分享失败",children:[]},{level:3,title:"问题三：通过链接进入只能分享出link",slug:"问题三-通过链接进入只能分享出link",children:[]}]}],filePathRelative:"web-developer/back-end/wechat/wx-share.md",git:{updatedTime:1646300916e3,contributors:[{name:"黎聪",email:"licong23@xdf.cn",commits:1}]}}},9395:(n,a,s)=>{s.r(a),s.d(a,{default:()=>t});const e=(0,s(6252).uE)('<h1 id="微信分享" tabindex="-1"><a class="header-anchor" href="#微信分享" aria-hidden="true">#</a> 微信分享</h1><h2 id="获取签名" tabindex="-1"><a class="header-anchor" href="#获取签名" aria-hidden="true">#</a> 获取签名</h2><h2 id="微信分享失败问题" tabindex="-1"><a class="header-anchor" href="#微信分享失败问题" aria-hidden="true">#</a> 微信分享失败问题</h2><h3 id="问题一-第一次调用签名会失败" tabindex="-1"><a class="header-anchor" href="#问题一-第一次调用签名会失败" aria-hidden="true">#</a> 问题一：第一次调用签名会失败</h3><p>第一次调用签名会失败，第二次调用签名会成功，后面再调用都会成功。</p><h3 id="问题二-页面切换分享失败" tabindex="-1"><a class="header-anchor" href="#问题二-页面切换分享失败" aria-hidden="true">#</a> 问题二：页面切换分享失败</h3><p>获取签名以及配置分享成功之后，当前页面可以分享，但是切换到其它页面分享就会失败。解决方案是监听路由变化，每次切换页面都要重新执行分享配置</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>router<span class="token punctuation">.</span><span class="token function">afterEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>wx<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> <span class="token punctuation">{</span> title<span class="token punctuation">,</span> desc<span class="token punctuation">,</span> link<span class="token punctuation">,</span> imgUrl <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">;</span>\n    wx<span class="token punctuation">.</span><span class="token function">updateAppMessageShareData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      title<span class="token punctuation">,</span> <span class="token comment">// 分享标题</span>\n      desc<span class="token punctuation">,</span> <span class="token comment">// 分享描述</span>\n      link<span class="token punctuation">,</span> <span class="token comment">// 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致</span>\n      imgUrl<span class="token punctuation">,</span> <span class="token comment">// 分享图标</span>\n      <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// 设置成功</span>\n        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;设置成功 分享给朋友&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\t<span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="问题三-通过链接进入只能分享出link" tabindex="-1"><a class="header-anchor" href="#问题三-通过链接进入只能分享出link" aria-hidden="true">#</a> 问题三：通过链接进入只能分享出<code>link</code></h3><ul><li>通过链接地址直接进入，获取签名以及分享配置成功，但是分享出去的只有配置的<code>link</code>地址，没有<code>title</code>和<code>imgUrl</code>。</li><li>通过二维码进入，分享正常。</li><li>通过他人正常分享出来的途径进入，分享正常。</li><li>通过公众号配置的栏目打开，分享正常。</li></ul>',10),t={render:function(n,a){return e}}}}]);